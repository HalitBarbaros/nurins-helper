<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nurin's Little Helper</title>

<style>
:root{
    --bg:#fdfcf8;--header:#f7f5f2;--card:#fff;--text:#121212;
    --muted:#666;--gold:#d97706;--border:#e2e2e2;
    --serif:Georgia,serif;
    --sans:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
}
body{margin:0;font-family:var(--sans);background:var(--bg);color:var(--text)}
header{position:sticky;top:0;background:var(--header);padding:20px 40px;border-bottom:1px solid var(--border);z-index:100}
h1{margin:0;font-family:var(--serif)}
.tools{display:flex;gap:10px;margin-top:10px}
input{padding:8px 14px;border:1px solid #ccc;border-radius:4px}
button{cursor:pointer}
.nav{display:flex;gap:10px;margin-top:15px}
.nav-btn{background:none;border:none;font-weight:700;font-size:.85rem;color:#666}
.nav-btn.active{color:#000;border-bottom:2px solid #000}
.nav-btn.saved.active{color:var(--gold);border-color:var(--gold)}

#pitch-bar{display:none;margin:20px 40px;padding:15px;border:1px solid var(--border);background:#fff;justify-content:space-between}
#pitch-bar.show{display:flex}

#grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:30px;padding:30px 40px}
.card{border:1px solid var(--border);background:#fff;cursor:pointer;position:relative}
.card img{width:100%;height:180px;object-fit:cover;display:block}
.card-content{padding:15px}
.headline{font-family:var(--serif);font-weight:700}

.star{position:absolute;bottom:10px;right:10px;width:32px;height:32px;border-radius:50%;border:1px solid #eee;background:#fff}
.star.saved{background:var(--gold);color:#fff}

#modal{display:none;position:fixed;inset:0;background:rgba(255,255,255,.95);z-index:2000;justify-content:center;align-items:center}
#modal.open{display:flex}
.modal-box{background:#fff;max-width:800px;width:90%;max-height:90vh;overflow:auto;border:1px solid #ccc}
.modal-img{height:350px}
.modal-img img{width:100%;height:100%;object-fit:cover}
.modal-content{padding:40px}

#toast{visibility:hidden;position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:#000;color:#fff;padding:12px 24px;border-radius:4px}
#toast.show{visibility:visible}
</style>
</head>

<body>

<header>
    <h1>Nurin's Little Helper</h1>
    <div class="tools">
        <input id="search" placeholder="Search..." oninput="debouncedRender()">
        <button onclick="init()">‚Üª Sync</button>
    </div>
    <div class="nav">
        <button class="nav-btn active" onclick="changeTab('all',this)">All</button>
        <button class="nav-btn" onclick="changeTab('space',this)">Space</button>
        <button class="nav-btn" onclick="changeTab('health',this)">Health</button>
        <button class="nav-btn" onclick="changeTab('environment',this)">Nature</button>
        <button class="nav-btn" onclick="changeTab('tech',this)">Tech</button>
        <button class="nav-btn saved" onclick="changeTab('saved',this)">‚òÖ Saved</button>
    </div>
</header>

<div id="pitch-bar">
    <div>Saved stories: <span id="saved-count">0</span></div>
    <button onclick="copyPitch()">üìã Copy</button>
    <button onclick="exportDoc()">üìù Google Doc</button>
</div>

<div id="grid"></div>

<div id="modal" onclick="closeModal(event)">
    <div class="modal-box">
        <div class="modal-img"><img id="modal-img"></div>
        <div class="modal-content">
            <h2 id="modal-title"></h2>
            <p id="modal-desc"></p>
            <a id="modal-link" target="_blank">Read full story ‚Üó</a>
        </div>
    </div>
</div>

<div id="toast"></div>

<script>
const feeds=[
 {cat:"space",name:"Space.com",url:"https://www.space.com/feeds/all"},
 {cat:"health",name:"Medical News Today",url:"https://rss.medicalnewstoday.com/featured.xml"},
 {cat:"environment",name:"Nature",url:"https://www.nature.com/nature.rss"},
 {cat:"tech",name:"TechCrunch",url:"https://techcrunch.com/feed/"},
 {cat:"space",name:"NASA",url:"https://www.nasa.gov/rss/dyn/breaking_news.rss"}
];

let all=[],view='all';
let favs=JSON.parse(localStorage.getItem('nurinsFavs'))||[];
const MAX_ITEMS=80;

async function fetchFeed(f){
 const proxy=`https://api.allorigins.win/raw?url=${encodeURIComponent(f.url)}`;
 const res=await fetch(proxy); if(!res.ok)return[];
 const xml=new DOMParser().parseFromString(await res.text(),"text/xml");
 return [...xml.querySelectorAll("item")].slice(0,12).map(i=>{
  const link=i.querySelector("link")?.textContent;
  const d=i.querySelector("description")?.textContent||"";
  const m=d.match(/src="([^"]+)"/);
  return{
    id:link,cat:f.cat,source:f.name,
    title:i.querySelector("title")?.textContent,
    link,desc:d.replace(/<[^>]+>/g,'').slice(0,200),
    img:m?m[1]:"",time:new Date()
  };
 });
}

async function init(){
 all=[];
 document.getElementById("grid").innerHTML="<p style='grid-column:1/-1;text-align:center'>Loading‚Ä¶</p>";
 const results=await Promise.all(feeds.map(fetchFeed));
 results.flat().forEach(a=>{
  if(!all.find(x=>x.id===a.id)) all.push(a);
 });
 all.sort((a,b)=>b.time-a.time);
 all=all.slice(0,MAX_ITEMS);
 render();
}

function render(){
 const grid=document.getElementById("grid");
 const term=document.getElementById("search").value.toLowerCase();
 let list=view==="saved"?favs:
          view==="all"?all:all.filter(a=>a.cat===view);
 if(term) list=list.filter(a=>a.title.toLowerCase().includes(term));
 grid.innerHTML="";
 list.forEach(a=>{
  const saved=favs.some(f=>f.id===a.id);
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`
   <img loading="lazy" src="${a.img}">
   <button class="star ${saved?'saved':''}" onclick="event.stopPropagation();toggleFav('${a.id}')">‚òÖ</button>
   <div class="card-content">
     <div style="font-size:.7rem">${a.source}</div>
     <div class="headline">${a.title}</div>
   </div>`;
  c.onclick=()=>openModal(a);
  grid.appendChild(c);
 });
 document.getElementById("pitch-bar").classList.toggle("show",view==="saved");
 document.getElementById("saved-count").innerText=favs.length;
}

function toggleFav(id){
 const a=all.find(x=>x.id===id)||favs.find(x=>x.id===id);
 const i=favs.findIndex(x=>x.id===id);
 i>-1?favs.splice(i,1):favs.push(a);
 localStorage.setItem("nurinsFavs",JSON.stringify(favs));
 render();
}

function changeTab(t,b){
 document.querySelectorAll(".nav-btn").forEach(x=>x.classList.remove("active"));
 b.classList.add("active");
 view=t; render();
}

function openModal(a){
 document.getElementById("modal-title").innerText=a.title;
 document.getElementById("modal-desc").innerText=a.desc;
 document.getElementById("modal-img").src=a.img;
 document.getElementById("modal-link").href=a.link;
 document.getElementById("modal").classList.add("open");
}

function closeModal(e){if(e.target.id==="modal")document.getElementById("modal").classList.remove("open")}

function copyPitch(){
 navigator.clipboard.writeText(favs.map(f=>`${f.title} ‚Äì ${f.link}`).join("\n\n"));
 toast("Copied");
}

function exportDoc(){
 const html=`<html><body><h2>Nurin Pitch List</h2>${favs.map(f=>`<p><b>${f.title}</b><br><a href="${f.link}">${f.link}</a></p>`).join("")}</body></html>`;
 const blob=new Blob([html],{type:"application/msword"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="Nurin_Pitch_List.doc";
 a.click();
}

function toast(t){
 const el=document.getElementById("toast");
 el.innerText=t; el.className="show";
 setTimeout(()=>el.className="",2000);
}

let timer;
function debouncedRender(){clearTimeout(timer);timer=setTimeout(render,200)}

init();
</script>
</body>
</html>
